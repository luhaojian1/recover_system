<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>缴费模块</title>
    <link href="../css/bootstrap-combined.min.css" rel="stylesheet" type="text/css">
    <link href="../css/layoutit.css" rel="stylesheet" type="text/css">
    <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <script src="../js/jquery-2.0.0.min.js"></script>
    <script src="../js/jquery-ui.js"></script>
    <script src="../js/jquery.htmlClean.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/patient.js"></script>

</head>
<body style="margin:0;">
<!-- 引入导航栏 -->
<div class="navbar navbar-inverse">
    <div class="navbar-inner">
        <div class="container-fluid">
            <a data-target=".navbar-responsive-collapse" data-toggle="collapse" class="btn btn-navbar"><span
                    class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a>
            <a id="home_page" href="../html/MRMS_Doctor.html" class="brand">康复医疗管理系统</a>
            <div class="nav-collapse collapse navbar-responsive-collapse">
                <ul class="nav">
                    <li><a href="../html/MRMS_Manager_Patient_List.html">患者信息管理</a></li>
                    <li class="dropdown active">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">用户管理<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li> <a href="../html/MRMS_Manager_AddUser.html">创建新用户</a></li>
                            <li><a href="../html/MRMS_Manager_UserList.html">用户列表</a></li>

                        </ul>
                    </li>
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">随访管理<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li> <a href="../html/MRMS_Manager_FollowUpPlan.html">发布随访计划</a></li>
                            <li><a href="../html/MRMS_Manager_FollowUpPlan_List.html">随访计划列表</a></li>
                            <li><a href="../html/MRMS_Manager_FollowUpPlan_Record_List.html">随访记录管理</a></li>
                        </ul>
                    </li>

                </ul>
                <ul class="nav pull-right">
                    <div class="btn-group">
                        <button id="user-name" class="btn" ></button>
                        <button data-toggle="dropdown" class="btn dropdown-toggle"><span class="caret"></span></button>
                        <ul class="dropdown-menu" >
                            <li>
                                <a href="../html/MRMS_Personal_Center.html" onclick="setPersonalHomePage($('#home_page').attr('href'))">个人设置</a>
                            </li>
                            <li>
                                <a href="/signOut">退出</a>
                            </li>
                            <li class="divider"></li>
                        </ul>
                    </div>

                </ul>
            </div>

        </div>
    </div>

</div>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">

            <div class="row-fluid">
                <div class="span4">
                </div>
                <div class="span6">
                    <h3>创建新用户</h3>
                    <hr>
                    <div>
                        <!-- 添加患者信息 -->
                        <div id="add_user_info">
                            <form id="add_user">
                                <table>
                                    <tr>
                                        <td>用户姓名</td>
                                        <td><input id="userName" type="text" name="userName" value="" required="required"/>*</td>
                                    </tr>
                                    <tr>
                                        <td>用户密码</td>
                                        <td><input id="passWord" type="text" name="passWord" value="123456"
                                                   required="required"/>*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label>职称</label></td>
                                        <td><select id="jobPosition" name="jobPosition" style="width: 150px;">
                                            <option value="管理员">管理员</option>
                                            <option value="收费员">收费员</option>
                                            <option value="医生">普通医生</option>
                                            <option value="副主任">副主任</option>
                                            <option value="主任">主任</option>
                                            <option value="治疗师">治疗师</option>
                                        </select>*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label>部门</label></td>
                                        <td>
                                            <select id="higherOffice"
                                                    onclick="sickOfficeChange(this,document.getElementById('sickOffice'));"
                                                    style=" width:120px; height:30px;line-height:30px; ">
                                            <option value="null">请选择科室</option>
                                            <option value="JZ">
                                                急诊科
                                            </option>
                                            <option value="JSXL">
                                                精神心理科
                                            </option>
                                            <option value="NK">
                                                内科
                                            <option value="WK">
                                                外科
                                            </option>
                                            <option value="FC">
                                                妇产科
                                            </option>
                                            <option value="MAN">
                                                男科
                                            </option>
                                            <option value="CD">
                                                儿科
                                            </option>
                                            <option value="WG">
                                                五官科
                                            </option>
                                            <option value="ZL">
                                                肿瘤科
                                            </option>
                                            <option value="PFXB">
                                                皮肤性病科
                                            </option>
                                            <option value="ZY">
                                                中医科
                                            </option>


                                        </select>
                                            <select  id="sickOffice"
                                                     style=" width:120px; height:30px;line-height:30px; " onclick="setOffice(this.value)">
                                                <option value="null">请选择</option>
                                            </select>*(请先选择部门)
                                        </td>

                                        <td><p id="categoryTip"></p></td>
                                    </tr>
                                    <tr>
                                        <td><label>科室</label></td>
                                        <td>
                                            <select  id="officeId" name="officeId"
                                                     style=" width:120px; height:30px;line-height:30px; " >
                                                <option value="null">请选择</option>
                                            </select>
                                        </td>
                                        <td></td><p id="officeIdTip"></p></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label>出生日期</label></td>
                                        <td><input id="mpBirthday" type="date" name="mpBirthday" required="required"
                                                   onchange="setAge(this.value)" style="width: 135px;"></td>
                                    </tr>

                                    <tr>
                                        <td>年龄</td>
                                        <td><input id="age" type="number" name="age" max="150" min="0" size="10"
                                                   style="width: 50px;" required="required"></td>
                                    </tr>
                                    <tr>
                                        <td>性别</td>
                                        <td>
                                            <select id="sex" name="sex" style="width: 60px;">
                                                <option value="true">男</option>
                                                <option value="false">女</option>
                                            </select>*
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>
                                            <label>就诊人数</label></td>
                                        <td><input id="registerSum" type="number" name="registerSum" value="" min="0" max="200"
                                                   required="required" style="width: 50px;">*
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>
                                            <label>学科专业</label></td>
                                        <td><input id="subject" type="text" name="subject" value=""
                                                   required="required">*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label>医生简介</label></td>
                                        <td><input id="doctorIntroduction" required="required"
                                                   type="text" style="width:300px; height:150px;"
                                                   name="doctorIntroduction" value="">*
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>

                                        </td>
                                    </tr>
                                </table>
                                <div>
                                    <label class="checkbox">
                                        <button class="btn btn-primary" type="button" onclick="addUserInfo($('#add_user'))">提交
                                        </button>
                                        <button id="reset_user_form" class="btn" type="button" onclick="resetUserForm($('#add_user'))">重置</button>
                                    </label>
                                </div>
                            </form>

                        </div>

                    </div>

                </div>
                <div class="span2">
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    window.onload = function () {
        var userId = getCookie('userId');
        var userName = getCookie('userName');
        console.log(userId + " " + userName);
        document.getElementById("user-name").innerHTML = userName;
    }

    //查找office
    function setOffice(office) {
        //每次发生改变时先清空子节点
        $("#officeId").html("");
        $.ajax({
            type: "get",
            url: "/findOffice",
            data: {
               higherOffice: office
            },
            dataType: "json",
            success: function (map) {
                console.log(map.offices);

                var option = '<option value="">请选择</option>';
                $.each(map.offices, function (i, office) {
                    option += '<option value="' + office.officeId + '">' + office.officeName + '</option>';
                });

                $("#officeId").append(option);

            },
            error: function () {
                return;
            }

        })
    }

    //重置表单
    function resetUserForm(form) {
        form[0].reset();
    }


    //根据生日设置年龄
    function setAge(birthday) {
        console.log(birthday);
        var nowDay = new Date();
        var oldDay = new Date(birthday);
        console.log(nowDay);
        var result = nowDay.getTime() - oldDay.getTime();
        console.log("差值" + result);
        var year = 365 * 24 * 3600 * 1000;
        var age = Math.floor(result / year);
        if (age < 0)
            age = 0;
        console.log(age);
        $("#age").val(age);
    }


    //验证表单
    function validateForm() {
        var userName = $("#userName").val();
        var password = $("#passWord").val();
    }
    //创建新用户
    function addUserInfo(userForm) {

        if (higherOffice == "" || higherOffice == null){
            $("#categoryTip").text("请选择部门");
            $("#categoryTip").attr("color", "red");
            return;
        }
        if (officeId == "" || officeId == null) {
            $("#officeIdTip").text("请选择科室");
            $("#officeIdTip").attr("color", "red");
            return ;
        }
        $.ajax({
            type: "post",
            url: "/addUser",
            data: userForm.serialize(),
            dataType: "json",
            success: function (data) {

                if (data == true){
                    alert("添加成功");
                    window.location.reload();
                }
                else{
                    alert('添加失败，请检查数据格式是否符合要求或带"*"号输入框是否填写');
                    return;
                }


            }

        });

    }

    var sickOffice = new Object();
    sickOffice['JZ'] = ['急诊科'];
    sickOffice['JSXL'] = ['精神科', '心里咨询科'];
    sickOffice['NK'] = ['消化内科', '呼吸内科', '神经内科', '心血管内科', '肾内科', '血液内科', '免疫科', '内分泌科'];
    sickOffice['WK'] = ['普通外科', '神经外科', '心胸外科', '泌尿外科', '心血管外科', '乳腺外科', '肝胆外科', '肛肠外科', '烧伤科', '骨外科'];
    sickOffice['FC'] = ['妇科', '产科'];
    sickOffice['MAN'] = ['男科'];
    sickOffice['CD'] = ['儿科综合', '小儿内科', '小儿外科', '新生儿科', '儿童营养保健科'];
    sickOffice['WG'] = ['耳鼻喉科', '眼科', '口腔科'];
    sickOffice['ZL'] = ['肿瘤内科', '肿瘤外科', '肿瘤综合科', '肿瘤康复科'];
    sickOffice['PFXB'] = ['皮肤病科', '性病科'];
    sickOffice['ZY'] = ['中医全科', '中医内科', '中医外科', '中医儿科', '针灸按摩科'];


    //改变科室
    function sickOfficeChange(office, sOffice) {
        console.log(office.value+ " " +sOffice);
        $("#sickOffice").empty();
        var o, so;
        var i, ii;
        o = office.value;
        so = sOffice.value;
        sOffice.length = 1;
        if (o == '0') return;
        if (typeof (sickOffice[o]) == 'undefined') return;

        console.log(sickOffice[o].length);
        for (i = 0; i < sickOffice[o].length; i++) {
            ii = i + 1;

            sOffice.options[ii] = new Option();
            sOffice.options[ii].text = sickOffice[o][i];
            sOffice.options[ii].value = o+""+ii;
        }
        sOffice.options[0].text = "请选择";

    }
</script>
</html>