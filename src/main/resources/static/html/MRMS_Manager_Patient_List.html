<!DOCTYPE html>
<html lang="zh-CN" >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>缴费模块</title>
    <link href="../css/bootstrap-combined.min.css" rel="stylesheet" type="text/css">
    <link href="../css/layoutit.css" rel="stylesheet" type="text/css">
    <link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <script src="../js/jquery-2.0.0.min.js"></script>
    <script src="../js/jquery-ui.js"></script>
    <script src="../js/jquery.htmlClean.js"></script>
    <script src="../js/base-method.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/patient_list.js"></script>
</head>
<body style="margin:0;">
<!-- 引入导航栏 -->
<div class="navbar navbar-inverse"  >
    <div class="navbar-inner">
        <div class="container-fluid">
            <a data-target=".navbar-responsive-collapse" data-toggle="collapse" class="btn btn-navbar">
                <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
            </a> <a id="home_page" href="../html/MRMS_Doctor.html" class="brand">康复医疗管理系统</a>
            <div class="nav-collapse collapse navbar-responsive-collapse">
                <ul class="nav">
                    <li class="active"><a href="../html/MRMS_Manager_Patient_List.html">患者信息管理</a></li>
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">用户管理<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li> <a href="../html/MRMS_Manager_AddUser.html">创建新用户</a></li>
                            <li><a href="../html/MRMS_Manager_UserList.html">用户列表</a></li>

                        </ul>
                    </li>
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">随访管理<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li> <a href="../html/MRMS_Manager_FollowUpPlan.html">发布随访计划</a></li>
                            <li><a href="../html/MRMS_Manager_FollowUpPlan_List.html">随访计划列表</a></li>
                            <li><a href="../html/MRMS_Manager_FollowUpPlan_Record_List.html">随访记录管理</a></li>
                        </ul>
                    </li>

                </ul>
                <ul class="nav pull-right">
                    <div class="btn-group">
                        <button id="user-name" class="btn" ></button>
                        <button data-toggle="dropdown" class="btn dropdown-toggle"><span class="caret"></span></button>
                        <ul class="dropdown-menu" >
                            <li>
                                <a href="../html/MRMS_Personal_Center.html" onclick="setPersonalHomePage($('#home_page').attr('href'))">个人设置</a>
                            </li>
                            <li>
                                <a href="/signOut">退出</a>
                            </li>
                            <li class="divider"></li>
                        </ul>
                    </div>

                </ul>
            </div>

        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row-fluid">

        <div  class="span12">
            <div class="tabbable" id="tabs-385726">
                <hr>
                <div class="span12">
                    <div class="row-fluid">
                        <div class="span4">
                            <a id="modal-896282" href="#find_patients" role="button"
                               class="btn" data-toggle="modal">搜索患者信息</a>
                            <a  role="button"
                                class="btn"  onclick="findAllPaitent('#patient_partial_list',1)">返回初始列表</a>
                        </div>
                        <div class="span5">
                        </div>
                        <div class="span2">

                        </div>
                        <div class="span1">
                        </div>
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span12">
                        <!-- 患者信息列表 -->
                        <div id="patient_list_model" >

                            <!-- 搜索模块 -->

                            <div id="find_patients" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <label>搜索框</label>
                                </div>
                                <div class="modal-body">
                                    <form id="find_appointed_patients" class="form-search">
                                        <table>
                                            <tr>
                                                <td>患者ID</td><td><input  type="text"  name="patientId" /></td>

                                            </tr>
                                            <tr>
                                                <td>姓名</td><td><input  type="text"  name="patientName"  ></td>

                                            </tr>

                                            <tr>
                                                <td>年龄</td><td><input type="number" name="age" max="150" min="0" size="10"></td>
                                            </tr>
                                            <tr>
                                                <td><label>民族</label></td><td><select id="nation1" name="nation" >
                                                <option value="">请选择</option>
                                            </select></td>
                                            </tr>
                                            <tr><td>
                                                <label >身份证号码 </label></td><td><input  type="text" name="carId"   onchange="checkCardId(this.value,'flag2')"><p id="flag2" ></p>
                                            </td></tr>
                                            <tr><td>
                                                <label>联系方式</label></td><td><input id="iphone" type="text" name="phoneNumber"  onchange="checkphoneNumber(this.value,'phone')"
                                            ><p id="phone"></p></td></tr>
                                            <tr><td>
                                                <label>出生日期</label></td><td><input id="birthday" type="date" name="mpBirthday" ></td></tr>
                                            <tr><td>
                                                <label>血型</label></td><td><select  name="bloodType" style="width:100px">
                                                <option value="">请选择</option>
                                                <option value="A">A</option>
                                                <option value="B">B</option>
                                                <option value="AB">AB</option>
                                                <option value="O">O</option>
                                            </select>型
                                            </td></tr>

                                        </table>

                                        <div class="modal-footer">
                                            <button  class="btn btn-primary"  data-dismiss="modal" onclick="findAppointedPatient($('#find_appointed_patients').serialize(),1)">搜索</button>
                                            <input  class="btn" type="reset" value="重置"/>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div>
                                <h3>患者列表</h3>
                                <table class="table table-bordered table-hover">
                                    <thead>
                                    <tr>
                                        <th>患者ID</th>
                                        <th>患者姓名</th>
                                        <th>性别</th>
                                        <th>年龄</th>
                                        <th>民族</th>
                                        <th>籍贯</th>
                                        <th>家庭地址</th>
                                        <th>身份证</th>
                                        <th>联系方式</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody id="patient_partial_list">

                                    </tbody>
                                </table>
                                <!-- 分页模块 -->
                                <div class="pagination pagination-centered">
                                    <ul id="paginationList">

                                    </ul>
                                </div>
                            </div>
                            <!-- 更新模块 -->
                            <div id="update_patient" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <label>患者信息</label>
                                </div>
                                <div class="modal-body">
                                    <form id="update_appointed_patient" >
                                        <table>
                                            <tr>
                                                <td>患者ID</td><td><input id="updatePatientId" type="text"  name="patientId" readonly="readonly"/></td>

                                            </tr>
                                            <tr>
                                                <td>姓名</td><td><input id="updatePatientName" type="text"  name="patientName"  ></td>

                                            </tr>
                                            <tr>

                                                <td>性别</td><td>
                                                <select id="updateSex"  name="sex" style="width: 100px;">
                                                    <option value="">请选择</option>
                                                    <option value="true">男</option>
                                                    <option value="false">女</option>
                                                </select></td>
                                            </tr>
                                            <tr>
                                                <td>年龄</td><td><input id="updateAge" type="number" name="age" max="150" min="0" size="10"></td>
                                            </tr>
                                            <tr>
                                                <td><label>民族</label></td><td><select id="updateNation" name="nation"  >
                                                <option value="">请选择</option>
                                            </select></td>
                                            </tr>

                                            <tr>
                                                <td>籍贯</td><td><select id="province" onchange="chinaChange(this,document.getElementById('updateCity'));" style=" width:120px; height:30px;line-height:30px; ">
                                                <option value="">请选择省份</option>
                                                <option value ="北京市">
                                                    <lable>北京市 </lable></option><option value ="天津市">
                                                <lable>天津市 </lable></option><option value ="上海市">
                                                <lable>上海市 </lable></option><option value ="重庆市">
                                                <lable>重庆市 </lable></option><option value ="河北省">
                                                <lable>河北省 </lable></option><option value ="山西省">
                                                <lable>山西省 </lable></option><option value ="辽宁省">
                                                <lable>辽宁省 </lable></option><option value ="吉林省">
                                                <lable>吉林省 </lable></option><option value ="黑龙江省">
                                                <lable>黑龙江省</lable></option><option value ="江苏省">
                                                <lable>江苏省 </lable></option><option value ="浙江省">
                                                <lable>浙江省 </lable></option><option value ="安徽省">
                                                <lable>安徽省 </lable></option><option value ="福建省">
                                                <lable>福建省 </lable></option><option value ="江西省">
                                                <lable>江西省 </lable></option><option value ="山东省">
                                                <lable>山东省 </lable></option><option value ="河南省">
                                                <lable>河南省 </lable></option><option value ="湖北省">
                                                <lable>湖北省 </lable></option><option value ="湖南省">
                                                <lable>湖南省 </lable></option><option value ="广东省">
                                                <lable>广东省 </lable></option><option value ="海南省">
                                                <lable>海南省 </lable></option><option value ="四川省">
                                                <lable>四川省 </lable></option><option value ="贵州省">
                                                <lable>贵州省 </lable></option><option value ="云南省">
                                                <lable>云南省 </lable></option><option value ="陕西省">
                                                <lable>陕西省 </lable></option><option value ="甘肃省">
                                                <lable>甘肃省 </lable></option><option value ="青海省">
                                                <lable>青海省 </lable></option><option value ="台湾省">
                                                <lable>台湾省 </lable></option><option value ="广西壮族自治区">
                                                <lable>广西壮族自治区</lable></option><option value ="内蒙古自治区">
                                                <lable>内蒙古自治区</lable></option><option value ="西藏自治区">
                                                <lable>西藏自治区</lable></option><option value ="宁夏回族自治区">
                                                <lable>宁夏回族自治区</lable> </option><option value ="新疆维吾尔自治区">
                                                <lable>新疆维吾尔自治区</lable></option><option value ="香港特别行政区">
                                                <lable>香港特别行政区</lable></option><option value ="澳门特别行政区">
                                                <lable>澳门特别行政区</lable></option>
                                            </select>
                                                <select  name="nativePlace" id="updateCity" style=" width:120px; height:30px;line-height:30px; ">
                                                    <option value="">请选择市区</option>
                                                </select>
                                            </td>
                                            </tr>
                                            <tr><td>
                                                <label>家庭地址</label></td><td><input id="updateHomeAdress"  type="text" name="homeAdress" ></label></td></tr>
                                            </select>
                                            <tr><td>
                                                <label >身份证号码 </label></td><td><input  id="updateCardId" type="text" name="carId"   onchange="checkCardId(this.value,'flag')">
                                            </td><td><p id="flag" ></p></td></tr>
                                            <tr><td>
                                                <label>联系方式</label></td><td><input id="updatePhone" type="text" name="phoneNumber"  onchange="checkphoneNumber(this.value,'updatePhoneNum')"
                                            ></td><td><p id="updatePhoneNum"></p></td></tr>
                                            <tr><td>
                                                <label>出生日期</label></td><td><input id="updateBirthday" type="date" name="mpBirthday" ></td></tr>
                                            <tr><td>
                                                <label>职业</label></td><td><input id="updateOccupation"  type="text" name="occupation" ></td></tr>
                                            <tr><td>
                                                <label>单位</label></td><td><input id="updateWorkPlace"  type="text" name="workPlace" ></td></tr>
                                            <tr><td>
                                                <label>血型</label></td><td><select id="updateBloodType"  name="bloodType" style="width:100px">
                                                <option value="">请选择</option>
                                                <option value="A">A</option>
                                                <option value="B">B</option>
                                                <option value="AB">AB</option>
                                                <option value="O">O</option>
                                            </select>型
                                            </td></tr>
                                            <tr><td>
                                                <label>是否存在家族病史</label></td><td><select id="updateFamSickHistroy" onchange="change(this.value,'updateSickHistrionicInstruction')"
                                                                                        name="famSickHistroy"  style="width: 50px;">
                                                <option value="true">是</option>
                                                <option value="false" >否</option>
                                            </select></td></tr>
                                            <tr><td>
                                                <label>家族病史说明</label></td><td><input  id="updateSickHistrionicInstruction"
                                                                                      type="text" style="width:300px; height:150px;" name="sickHistrionicInstruction" value=""></td></tr>
                                            <tr><td>
                                                <label >是否药物过敏</label></td><td><select id="updateDrugAllergy" onchange="change(this.value,'updateDrugAllergyIntroduction')" name="drugAllergy"  style="width: 50px;">
                                                <option value="true">是</option>
                                                <option value="false" >否</option>
                                            </select></td></tr>
                                            <tr><td>
                                                <label id="whetherDrugAllergy"  for="updateDrugAllergyIntroduction">药物过敏说明</label></td><td><input  id="updateDrugAllergyIntroduction"  type="text"
                                                                                                                                                   style="width:300px; height:150px;" name="drugAllergyIntroduction" value=""></td></tr>
                                        </table>
                                        <div class="modal-footer">
                                            <button  class="btn btn-primary"  data-dismiss="modal" onclick="updatePatient('update_appointed_patient')">修改</button>
                                            <button class="btn "  data-dismiss="modal" aria-hidden="true">关闭</button>
                                        </div>
                                    </form>
                                </div>

                            </div>
                            <!-- 删除模块 -->
                            <div id="delete_model" class="modal hide fade"
                                 role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal"
                                            aria-hidden="true">×</button>
                                </div>
                                <form id="delete_patient" >
                                    <input id="deletePatientId" type="hidden" name="patientId" value="" readonly="readonly">
                                    <div class="modal-body">
                                        <h4>是否确认删除</h4>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="deletePatient()">确定</button>
                                    </div>
                                </form>
                            </div>


                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

</body>
<script type="text/javascript">
    $(document).ready(function () {

        var userId = getCookie('userId');
        var userName = getCookie('userName');
        console.log(userId+" "+userName);
        //alert(userName);
        document.getElementById("user-name").innerHTML = userName;
        findAllPaitent("#patient_partial_list",1);
    });




    var nations = ["汉族","蒙古族","回族","藏族","维吾尔族","苗族","彝族","壮族","布依族","朝鲜族","满族","侗族","瑶族","白族","土家族",
        "哈尼族","哈萨克族","傣族","黎族","傈僳族","佤族","畲族","高山族","拉祜族","水族","东乡族","纳西族","景颇族","柯尔克孜族",
        "土族","达斡尔族","仫佬族","羌族","布朗族","撒拉族","毛南族","仡佬族","锡伯族","阿昌族","普米族","塔吉克族","怒族", "乌孜别克族",
        "俄罗斯族","鄂温克族","德昂族","保安族","裕固族","京族","塔塔尔族","独龙族","鄂伦春族","赫哲族","门巴族","珞巴族","基诺族"];
    var option = "";
    for(var i = 0; i <
    nations.length; i++) {
        option += '<option value="' +  nations[i] + '">' + nations[i] + '</option>';
    }
    $(option).appendTo("#nation");
    $(option).appendTo("#nation1");
    $(option).appendTo("#updateNation");

    //找出所有的患者信息列表
    function findAllPaitent(name,pageNum) {
        console.log(name + " " + pageNum);
        $.ajax({
            type:"get",
            url:"/findAllPatient",
            data:{
                pageNum:pageNum,
                pageSize:5
            },
            success:function (map) {
                console.log(map.patients);
                var tbody = "";
                $( "#patient_partial_list").html("");
                $("#paginationList").html("");
                $.each(map.patients.list,function (i,patient) {
                    var sex= patient.sex==true?"男":"女";
                    tbody += '<tr id='+'"'+patient.patientId+'"'+'><td>'+ patient.patientId +'</td><td>'+ patient.patientName +'</td><td>'+sex
                        +'</td><td>'+ patient.age +'</td><td>'+ patient.nation+'</td><td>'+ patient.nativePlace
                        +'</td><td>'+ patient.homeAdress+'</td><td>'+ patient.carId+'</td><td>'+ patient.phoneNumber
                        +'</td><td><a href="#update_patient" type="button" class=" btn btn-warning" data-dismiss="modal"' +
                        'onclick="searchPatient('+patient.patientId+')">详细信息</a>' +
                        '<a href="#delete_model" type="button" class=" btn btn-danger" data-toggle="modal"'  +
                        'onclick="assignmentDeleteModel('+patient.patientId+')">删除</button></td></tr>';
                });
                $( "#patient_partial_list").append(tbody);
                var page = map.patients;
                var pageBody = pagination(page,"#patient_partial_list");
                $("#paginationList").append(pageBody);
            },
            error:function () {
                alert("找不到该患者的信息");
            }
        })
    }

    //自定义分页插件
    function pagination(page,name) {
        var pageBody = "";
        pageBody += '<li><a href="javascript:;" onclick="clickpage('+"'"+name+"'"+',1)" >首页</a></li>';
        if (page.pageNum != 1)
            pageBody += '<li> <a href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+ (page.pageNum-1)+')">上一页</a></li>';
        //当总页数少于8时，显示所有的页数，否则动态变换
        if (page.pages<8){
            for (var i=1 ; i<=page.pages;i++) {
                if(i == page.pageNum)
                    pageBody += '<li class="active"> <a  href="javascript:;"  onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';
                else
                    pageBody += '<li> <a  href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';
            }
        }
        else{
            if(page.pageNum-3<1){
                for (var i=1; i<page.pageNum;i++) {
                    pageBody += '<li> <a  href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';
                }
            }else{
                pageBody += '<li> <a  href="javascript:;" >...</a></li>';
                for (var i=page.pageNum-3; i<page.pageNum;i++) {
                    pageBody += '<li> <a  href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';
                }
            }
            //高亮当前页面
            pageBody += '<li class="active"> <a  href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';

            if(page.pageNum+4>page.pages){
                for (var i=page.pageNum+1; i<=page.pages;i++) {
                    pageBody += '<li> <a  href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';
                }
            }
            else{
                for (var i=page.pageNum+1; i<page.pageNum+4;i++) {
                    pageBody += '<li> <a  href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+i +')">'+i+'</a></li>';
                }
                pageBody += '<li> <a  href="javascript:;" >...</a></li>';
            }

        }

        if (page.pageNum != page.pages)
            pageBody += '<li> <a href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+ (page.pageNum+1)+')">下一页</a></li>';
        pageBody += '<li><a href="javascript:;" onclick="clickpage('+"'"+name+"'"+','+ (page.pages)+')">尾页</a></li>';
        pageBody += '<li><input type="text"  style="width: 40px; " id="pageNumberGo" >页</li>';
        pageBody += '<li><a href="javascript:;" onclick="pagejumping('+"'"+ name+"'" +')">跳转</a></li>';
        pageBody += '<li>&nbsp;&nbsp;&nbsp;&nbsp;共'+page.pageNum+'/'+page.pages+'页&nbsp;&nbsp;&nbsp;&nbsp;</li>';

        return pageBody;
    }

    //根据条件点击页码跳转
    function clickpage(name,number) {
        //console.log("clickpage():"+name+" "+number);
        if (name == "#patient_partial_list")
            findAllPaitent("'"+name+"'",number);
        else
            findAppointedPatient(name,number);
    }
    //根据输入的页数跳转
    function pagejumping(name) {
        var number = $("#pageNumberGo").val();
        if (number == null || number == ""){
            alert("请输入跳转页数");
            return false;
        }
        clickpage(name,number);
    }

    //找到指定的患者信息
    function findAppointedPatient(form,pageNum) {

        $.ajax({
            type:"get",
            url:'/findAppointedPatient/'+pageNum+'/5',
            data:form,
            dataType:"json",
            success:function (map) {
                console.log(map.patients);
                var tbody = "";                                           //
                $("#patient_partial_list").html("");
                $("#paginationList").html("");
                $.each(map.patients.list,function (i,patient) {
                    var sex= patient.sex==true?"男":"女";
                    tbody += '<tr id='+'"'+patient.patientId+'"'+'><td>'+ patient.patientId +'</td><td>'+ patient.patientName +'</td><td>'+sex
                        +'</td><td>'+ patient.age +'</td><td>'+ patient.nation+'</td><td>'+ patient.nativePlace
                        +'</td><td>'+ patient.homeAdress+'</td><td>'+ patient.carId+'</td><td>'+ patient.phoneNumber
                        +'</td><td><a href="#update_patient" role="button" class="btn btn-warning"  ' +
                        'onclick="searchPatient('+patient.patientId+')">详细信息</a>' +
                        '<a href="#delete_model" role="button" class="btn btn-danger" data-toggle="modal"'
                        +'onclick="assignmentDeleteModel('+patient.patientId+')">删除</a></td></tr>';
                });

                var page = map.patients;
                var pageBody = pagination(page,form);
                $("#paginationList").append(pageBody);
                $("#patient_partial_list").append(tbody);
            },
            error:function () {
                alert("找不到该患者的信息");
            }
        })
    }

    //根据患者id向服务器搜索患者信息并在详细信息模块进行设置
    function searchPatient(patientId) {
        console.log(patientId);

        $.ajax({
            type:"get",
            url:"/searchAppointedPatient",
            data:{"patientId":patientId},
            dataType:"json",
            success:function (patient) {
                console.log(patient);
                if (patient != null){
                    $("#updatePatientId").val(patient.patientId);
                    $("#updatePatientName").val(patient.patientName);
                    var sex = patient.sex;
                    var updateSex = document.getElementById("updateSex");
                    if(sex == true)
                        updateSex.options[1].selected=true;
                    else updateSex.options[2].selected=true;

                    $("#updateAge").val(patient.age);

                    var updateNation = document.getElementById("updateNation");
                    var nation = patient.nation;
                    for(var i=0;i<updateNation.options.length;i++){
                        if(updateNation.options[i].value==nation)
                            updateNation.options[i].selected=true;
                    }
                    var array = patient.nativePlace.split(",");
                    console.log(array[0]+" "+array[1]);
                    var province = document.getElementById("province");
                    var city = document.getElementById("updateCity");
                    for(var i=0;i<province.options.length;i++){
                        if(province.options[i].value==array[0])
                            province.options[i].selected=true;
                        chinaChange(province,city);
                    }
                    for(var i=0;i<city.options.length;i++){
                        //console.log(city.options[i].value+" "+array[1]);
                        if(city.options[i].value==patient.nativePlace)
                            city.options[i].selected=true;
                    }

                    $("#updateHomeAdress").val(patient.homeAdress);
                    $("#updateCardId").val(patient.carId);
                    $("#updatePhone").val(patient.phoneNumber);
                    var date =timestampToTime(patient.mpBirthday);
                    $("#updateBirthday").val(date);
                    $("#updateOccupation").val(patient.occupation);
                    $("#updateWorkPlace").val(patient.workPlace);
                    $("#updateBloodType").val(patient.bloodType); //血型
                    $("#updateFamSickHistroy").val(patient.famSickHistroy); //是否存在家族病史
                    var famSickHistroy = patient.famSickHistroy;
                    var updateFamSickHistroy = document.getElementById("updateFamSickHistroy");
                    if ( famSickHistroy == true){
                        updateFamSickHistroy.options[0].selected = true;
                        $("#updateSickHistrionicInstruction").val(patient.sickHistrionicInstruction); //家族病史说明
                    }
                    else{
                        updateFamSickHistroy.options[1].selected = true;
                        $("#updateSickHistrionicInstruction").attr("type","hidden");
                    }
                    var drugAllergy = patient.drugAllergy;
                    var updateDrugAllergy = document.getElementById("updateDrugAllergy"); //是否药物过敏
                    if (drugAllergy == true){
                        updateDrugAllergy.options[0].selected = true;
                        $("#updateDrugAllergyIntroduction").val(patient.drugAllergyIntroduction); //药物过敏说明
                    }
                    else{
                        updateDrugAllergy.options[1].selected = true;
                        $("#updateDrugAllergyIntroduction").attr("type","hidden");
                        document.getElementById("whetherDrugAllergy").style.display = "block";
                    }



                    $("#update_patient").modal();
                }
            },
            error:function () {
                alert("找不到该patient");
            }
        })
    }
    //日期格式化 yy-mm-dd
    function timestampToTime(timestamp) {
        var date = new Date(timestamp );//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        var Y = date.getFullYear() + '-';
        var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        var D = (date.getDate()+1 < 10 ? '0'+(date.getDate()+1) : date.getDate()+1) ;
        return Y+M+D;
    }
    //更新患者信息
    function updatePatient(formId) {
        var form = "#"+formId;
        $.ajax({
            type:"post",
            url:"/updatePatient",
            data:$(form).serialize(),
            dataType:"json",
            success:function (patient) {
                console.log(patient);
                if (patient != null )
                {
                    var cells = document.getElementById(patient.patientId).cells;
                    console.log(cells);
                    cells[0].innerHTML = ''+patient.patientId;
                    cells[1].innerHtml = patient.patientName;
                    cells[2].innerHTML = patient.sex == true?"男":"女";
                    cells[3].innerHTML = patient.age;
                    cells[4].innerHTML = patient.nation;
                    cells[5].innerHTML = patient.nativePlace;
                    cells[6].innerHTML = patient.homeAdress;
                    cells[7].innerHTML = patient.carId;
                    cells[8].innerHTML = patient.phoneNumber;
                    cells[9].innerHTML = '<a href="#update_patient" role="button" class="btn btn-warning"  ' +
                        'onclick="searchPatient('+patient.patientId+')">详细信息</a>'+
                        '<a href="#delete_model" role="button" class="btn btn-danger" data-toggle="modal"'
                        +'onclick="assignmentDeleteModel('+patient.patientId+')">删除</a>';
                    alert("修改成功");
                }
                else alert("修改失败，请检查数据格式是否正确");
            },
            error:function () {
                alert("修改失败，请检查数据格式是否正确");
            }

        })
    }

    //在删除模块中设置患者ID
    function assignmentDeleteModel(patientId) {
        $("#deletePatientId").val(patientId);
    }

    //删除病人信息
    function deletePatient() {
        var deleteatientId = $("#deletePatientId").val();
        $.ajax({
            type: "post",
            url: "/deletePatient",
            data: {"patientId": deleteatientId},
            dataType: "json",
            success: function (patient) {
                console.log(patient);
                document.getElementById(deleteatientId).remove();
                alert("删除成功");

            },
            error: function () {
                return;
            }
        })
    }

    //验证身份证号码是否重复
    function checkCardId(carId,lableId) {
        var id = carId ;
        var lable = "#"+lableId;
        var year = id.substring(6,10);
        var month = id.substring(10,12);
        var day = id.substring(12,14);
        var birthday=year+"-"+month+"-"+day;
        $("#mpBirthday").val(birthday);

        if (id.length !== 0){
            var reg = /^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
            var r = id.match(reg);
            if (r === null) {
                $(lable).html("身份证格式不正确");
                $(lable).attr('style','color:red;');
                return ;
            }
        }else{
            $(lable).html("");
            return ;
        }
        $.ajax({
            type:"get" ,
            url:"/searchPatientCarId",
            data:{"carId":id},
            dataType:"json",
            success: function (data) {
                console.log(data);
                if (data!=null){
                    $(lable).html("该身份证已被使用");
                    $(lable).attr('style','color:red;');
                }
            },
            error:function (data) {

                $(lable).html("√");
                $(lable).attr('style','color:green;');


            }

        })
    }

    //验证电话号码格式是否正确
    function checkphoneNumber(phoneNumber,lableId) {
        var id = phoneNumber ;
        var lable = "#"+lableId;
        if (id.length !== 0){
            var reg = /(\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$/;
            var r = id.match(reg);
            if (r === null) {
                $(lable).html("联系格式不正确");
                $(lable).attr('style','color:red;');
                return ;
            }
        }else{
            $(lable).html("√");
            return ;
        }

    }




    var china=new Object();
    china['北京市']=['北京市区','北京市辖区'];
    china['上海市']=['上海市区','上海市辖区'];
    china['天津市']=['天津市区','天津市辖区'];
    china['重庆市']=['重庆市区','重庆市辖区'];
    china['河北省'] = ['石家庄', '唐山市', '邯郸市', '秦皇市岛', '保市定', '张家市口', '承德市', '廊坊市', '沧州市', '衡水市', '邢台市'];
    china['山西省']=['太原市','大同市','阳泉市','长治市','晋城市','朔州市','晋中市','运城市','忻州市','临汾市','吕梁市'];
    china['辽宁省']=['沈阳市','大连市','鞍山市','抚顺市','本溪市','丹东市','锦州市','营口市','阜新市','辽阳市','盘锦市','铁岭市','朝阳市','葫芦岛市'];
    china['吉林省']=['长春市','吉林市','四平市','辽源市','通化市','白山市','松原市','白城市','延边州','长白山管委会'];
    china['黑龙江省']=['哈尔滨市','齐齐哈尔市','大庆市','佳木斯市','牡丹江市','七台河市','双鸭山市','黑河市','鸡西市','伊春市','绥化市','鹤岗市','加格达奇市'];
    china['江苏省']=['南京市','苏州市','无锡市','常州市','南通市','扬州市','镇江市','泰州市','盐城市','连云港市','宿迁市','淮安市','徐州市'];
    china['浙江省']=['杭州市','宁波市','温州市','嘉兴市','湖州市','绍兴市','金华市','衢州市','舟山市','台州市','丽水市'];
    china['安徽省']=['合肥市','芜湖市','蚌埠市','淮南市','马鞍山市','淮北市','铜陵市','安庆市','黄山市','滁州市','阜阳市','宿州市','巢湖市','六安市','亳州市','池州市','宣城市'];
    china['福建省']=['福州市','厦门市','莆田市','三明市','泉州市','漳州市','南平市','龙岩市','宁德市'];
    china['江西省']=['南昌市','景德镇市','萍乡市','九江市','新余市','鹰潭市','赣州市','吉安市','宜春市','抚州市','上饶市'];
    china['山东省']=['济南市','青岛市','淄博市','枣庄市','东营市','烟台市','潍坊市','济宁市','泰安市','威海市','日照市','莱芜市','临沂市','德州市','聊城市','滨州市','菏泽市'];
    china['河南省']=['郑州市','开封市','洛阳市','平顶山市','安阳市','鹤壁市','新乡市','焦作市','濮阳市','许昌市','漯河市','三门峡市','南阳市','商丘市','信阳市','周口市','驻马店市'];
    china['湖北省']=['武汉市','黄石市','十堰市','荆州市','宜昌市','襄樊市','鄂州市','荆门市','孝感市','黄冈市','咸宁市','随州市'];
    china['湖南省']=['长沙市','株洲市','湘潭市','衡阳市','邵阳市','岳阳市','常德市','张家界市','益阳市','郴州市','永州市','怀化市','娄底市'];
    china['广东省']=['广州市','深圳市','珠海市','汕头市','韶关市','佛山市','江门市','湛江市','茂名市','肇庆市','惠州市','梅州市','汕尾市','河源市','阳江市','清远市','东莞市','中山市','潮州市','揭阳市','云浮市'];
    china['海南省']=['文昌市','琼海市','万宁市','五指山市','东方市','儋州市'];
    china['四川省 ']=['成都市','自贡市','攀枝花市','泸州市','德阳市','绵阳市','广元市','遂宁市','内江市','乐山市','南充市','眉山市','宜宾市','广安市','达州市','雅安市','巴中市','资阳市'];
    china['贵州省']=['贵阳市','六盘水市','遵义市','安顺市'];
    china['云南省']=['昆明市','曲靖市','玉溪市','保山市','昭通市','丽江市','普洱市','临沧市'];
    china['陕西省']=['西安市','铜川市','宝鸡市','咸阳市','渭南市','延安市','汉中市','榆林市','安康市','商洛市'];
    china['甘肃省']=['兰州市','金昌市','白银市','天水市','嘉峪关市','武威市','张掖市','平凉市','酒泉市','庆阳市','定西市','陇南市'];
    china['青海省']=['西宁市'];
    china['台湾省'] = ['台北市','高雄市','基隆市','台中市','台南市','新竹市','嘉义市'];
    china['广西壮族自治区']=['南宁市','柳州市','桂林市','梧州市','北海市','防城港市','钦州市','贵港市','玉林市','百色市','贺州市','河池市','来宾市','崇左市'];
    china['内蒙古自治区']=['呼和浩特市','包头市','乌海市','赤峰市','通辽市','鄂尔多斯市','呼伦贝尔市','巴彦淖尔市','乌兰察布市'];
    china['西藏自治区']=["拉萨市"];
    china['宁夏回族自治区']=['银川市','石嘴山市','吴忠市','固原市','中卫市'];
    china['新疆维吾尔自治区']=['乌鲁木齐市','克拉玛依市'];
    china['香港特别行政区']=['台北市','高雄市','基隆市','台中市','台南市','新竹市','嘉义市'];


    //改变城市
    function chinaChange(province, city) {
        var pv, cv;
        var i, ii;
        pv = province.value;
        cv = city.value;
        city.length = 1;
        if (pv == '0') return;
        if (typeof (china[pv]) == 'undefined') return;


        for (i = 0; i < china[pv].length; i++) {
            ii = i + 1;

            city.options[ii] = new Option();
            city.options[ii].text = china[pv][i];
            city.options[ii].value = pv+","+china[pv][i];
        }
        city.options[0].text = "请选择市区";

    };



    function change(flag,id) {
        if("false" === flag)
            $("#"+id).attr('type','hidden');
        else $("#"+id).attr('type','text');
    }
    //获取cookie
    function getCookie(cname)
    {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++)
        {
            var c = ca[i].trim();
            if (c.indexOf(name)==0) return c.substring(name.length,c.length);
        }
        return "";
    }


</script>
</html>